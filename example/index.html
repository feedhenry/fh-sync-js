<html>
<head>
  <script
  src="https://code.jquery.com/jquery-3.2.1.min.js"
  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
  crossorigin="anonymous"></script>
  <!-- TODO improve example to use local distribution build !-->
  <script src="../dist/fh-sync.js" type="text/javascript"></script>
  <script src="./todo.js" type="text/javascript"></script>
  <link rel="stylesheet" type="text/css" href="main.css">
</head>
<body>

<div id="myDIV" class="header">
  <h2>My To Do List</h2>
  <input type="text" id="myInput" placeholder="Title...">
  <span onclick="newElement()" class="addBtn">Add</span>
</div>

<ul id="myUL">
  <li>First item</li>
  <!--<li>Hit the gym</li>
  <li class="checked">Pay bills</li>
  <li>Meet George</li>
  <li>Buy eggs</li>
  <li>Read a book</li>
  <li>Organize office</li>-->
</ul>

<script type="text/javascript">
  // setup sync cloud handler
    $fh.sync.setCloudHandler(function (params, success, failure) {
      $.ajax({
        'path': 'http://localhost:3000/sync/' + params.dataset_id,
        'method': 'post',
        'data': params.req
      }, function (res) {
        callbackCalled = true;
        success(res);
      }, function (msg, err) {
        callbackCalled = true;
        failure(msg, err);
    });
  });

  // Standard sync setup for simple dataset
  var datasetId = "myShoppingList";

  //provide sync init options
  $fh.sync.init({
    "sync_frequency": 10,
    "do_console_log": true,
    "storage_strategy": "dom"
  });

  //provide listeners for notifications.
  $fh.sync.notify(function(notification){
    var code = notification.code
    if('sync_complete' === code){
      //a sync loop completed successfully, list the update data
      $fh.sync.doList(datasetId,
        function (res) {
          console.log('Successful result from list:', JSON.stringify(res));
          },
        function (err) {
          console.log('Error result from list:', JSON.stringify(err));
        });
    } else {
      //choose other notifications the app is interested in and provide callbacks
    }
  });

  //manage the data set, repeat this if the app needs to manage multiple datasets
  var query_params = {}; //or something like this: {"eq": {"field1": "value"}}
  var meta_data = {};
  $fh.sync.manage(datasetId, {}, query_params, meta_data, function(){

  }); 
</script>
</body>
</html>